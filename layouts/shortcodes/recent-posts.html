{{/* layouts/shortcodes/recent-posts.html */}}
<section class="hx:mt-24">
  <h2 class="hx:text-2xl hx:font-bold hx:tracking-tight hx:text-slate-900 hx:dark:text-slate-100 hx:mb-6">{{ i18n "recent_posts" }}</h2>
  <div class="hextra-cards hx:mt-4 hx:gap-4 hx:grid not-prose" style="--hextra-cards-grid-cols:3">
    
    {{ $recentPages := where .Site.RegularPages "Type" "in" (slice "blog" "posts") }}
    
    {{/* 
      LA CORRECCIÓN CLAVE:
      En lugar de "range ...", usamos "range $post := ..."
      Esto guarda cada post en una variable llamada "$post" que no se pierde.
    */}}
    {{ range $post := first 6 $recentPages }}
      <a class="hextra-card hx:group hx:flex hx:flex-col hx:justify-start hx:overflow-hidden hx:rounded-lg hx:border hx:border-gray-200 hx:text-current hx:no-underline hx:bg-gray-100 dark:hx-bg-neutral-800 hx:shadow dark:hx-border-neutral-700 hover:hx-shadow-lg dark:hover:hx-border-neutral-500" href="{{ $post.RelPermalink }}">
        
        {{ with $post.Params.featured_image }}
          {{/* 
            Ahora, aunque "." aquí dentro sea la imagen, 
            todavía tenemos acceso al título a través de "$post.Title".
          */}}
          <img alt="Featured image for {{ $post.Title }}" class="hextra-card-image" loading="lazy" decoding="async" src="{{ . | relURL }}">
        {{ end }}
        
        <div class="hx:p-4">
          <span class="hx:font-semibold hx:text-gray-700 dark:hx-text-neutral-200">{{ $post.Title }}</span>
          <div class="hx:line-clamp-3 hx:mt-2 hx:text-sm hx:font-normal hx:text-gray-500 dark:hx-text-gray-400">
            {{ with $post.Params.description }}{{ . }}{{ else }}{{ $post.Summary | plainify | truncate 150 }}{{ end }}
          </div>
        </div>
      </a>
    {{ end }}

  </div>
</section>